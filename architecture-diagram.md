# PicklesCorp IAM Access Analyzer Demo - Architecture Diagram

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                          PicklesCorp AWS Account                                 â”‚
â”‚                                                                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ SCENARIO 1: External Access Analyzer                                     â”‚   â”‚
â”‚  â”‚                                                                           â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                â”‚   â”‚
â”‚  â”‚  â”‚  S3: AliceExternalBucket             â”‚                                â”‚   â”‚
â”‚  â”‚  â”‚  picklescorp-external-{account}      â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”¼â”€â”€â”
â”‚  â”‚  â”‚                                       â”‚  Cross-Account Access          â”‚   â”‚  â”‚
â”‚  â”‚  â”‚  â€¢ Block Public Access: ALL          â”‚  (GetObject, ListBucket)       â”‚   â”‚  â”‚
â”‚  â”‚  â”‚  â€¢ Auto-delete enabled               â”‚                                â”‚   â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                â”‚   â”‚  â”‚
â”‚  â”‚                                                                           â”‚   â”‚  â”‚
â”‚  â”‚  ğŸ“Š External Access Analyzer (Manual Setup)                              â”‚   â”‚  â”‚
â”‚  â”‚     â†’ Detects cross-account access                                       â”‚   â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚  â”‚
â”‚                                                                                   â”‚  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚  â”‚
â”‚  â”‚ SCENARIO 2: Unused Access Analyzer                                       â”‚   â”‚  â”‚
â”‚  â”‚                                                                           â”‚   â”‚  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                â”‚   â”‚  â”‚
â”‚  â”‚  â”‚  Lambda: AliceDemoFunction           â”‚                                â”‚   â”‚  â”‚
â”‚  â”‚  â”‚  picklescorp-demo-function           â”‚                                â”‚   â”‚  â”‚
â”‚  â”‚  â”‚                                       â”‚                                â”‚   â”‚  â”‚
â”‚  â”‚  â”‚  â€¢ Runtime: Python 3.12              â”‚                                â”‚   â”‚  â”‚
â”‚  â”‚  â”‚  â€¢ Actual Need: S3 Read Only         â”‚                                â”‚   â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                â”‚   â”‚  â”‚
â”‚  â”‚                 â”‚                                                         â”‚   â”‚  â”‚
â”‚  â”‚                 â”‚ Attached Role with EXCESSIVE Permissions:              â”‚   â”‚  â”‚
â”‚  â”‚                 â–¼                                                         â”‚   â”‚  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                â”‚   â”‚  â”‚
â”‚  â”‚  â”‚  IAM Role (Lambda Execution Role)    â”‚                                â”‚   â”‚  â”‚
â”‚  â”‚  â”‚                                       â”‚                                â”‚   â”‚  â”‚
â”‚  â”‚  â”‚  âŒ AmazonS3FullAccess               â”‚                                â”‚   â”‚  â”‚
â”‚  â”‚  â”‚  âŒ AmazonDynamoDBFullAccess         â”‚                                â”‚   â”‚  â”‚
â”‚  â”‚  â”‚  âŒ AmazonSQSFullAccess              â”‚                                â”‚   â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                â”‚   â”‚  â”‚
â”‚  â”‚                                                                           â”‚   â”‚  â”‚
â”‚  â”‚  ğŸ“Š Unused Access Analyzer (Manual Setup)                                â”‚   â”‚  â”‚
â”‚  â”‚     â†’ Identifies unused permissions                                      â”‚   â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚  â”‚
â”‚                                                                                   â”‚  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚  â”‚
â”‚  â”‚ SCENARIO 3: Internal Access Analyzer                                     â”‚   â”‚  â”‚
â”‚  â”‚                                                                           â”‚   â”‚  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                â”‚   â”‚  â”‚
â”‚  â”‚  â”‚  DynamoDB: CriticalCustomerData      â”‚                                â”‚   â”‚  â”‚
â”‚  â”‚  â”‚  picklescorp-critical-customer-data  â”‚                                â”‚   â”‚  â”‚
â”‚  â”‚  â”‚                                       â”‚                                â”‚   â”‚  â”‚
â”‚  â”‚  â”‚  â€¢ Partition Key: customerId         â”‚                                â”‚   â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                â”‚   â”‚  â”‚
â”‚  â”‚                 â”‚                                                         â”‚   â”‚  â”‚
â”‚  â”‚                 â”‚ Read/Write Access Granted To:                          â”‚   â”‚  â”‚
â”‚  â”‚                 â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                         â”‚   â”‚  â”‚
â”‚  â”‚                 â–¼                              â–¼                         â”‚   â”‚  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”‚   â”‚  â”‚
â”‚  â”‚  â”‚  IAM: DevRole            â”‚  â”‚  Lambda Function Role    â”‚            â”‚   â”‚  â”‚
â”‚  â”‚  â”‚  picklescorp-dev-role    â”‚  â”‚  (from Scenario 2)       â”‚            â”‚   â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â”‚   â”‚  â”‚
â”‚  â”‚                                                                           â”‚   â”‚  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                â”‚   â”‚  â”‚
â”‚  â”‚  â”‚  S3: CriticalDataBucket              â”‚                                â”‚   â”‚  â”‚
â”‚  â”‚  â”‚  picklescorp-critical-{account}      â”‚                                â”‚   â”‚  â”‚
â”‚  â”‚  â”‚                                       â”‚                                â”‚   â”‚  â”‚
â”‚  â”‚  â”‚  â€¢ Block Public Access: ALL          â”‚                                â”‚   â”‚  â”‚
â”‚  â”‚  â”‚  â€¢ Account-wide access policy        â”‚                                â”‚   â”‚  â”‚
â”‚  â”‚  â”‚    (GetObject, PutObject, Delete)    â”‚                                â”‚   â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                â”‚   â”‚  â”‚
â”‚  â”‚                                                                           â”‚   â”‚  â”‚
â”‚  â”‚  ğŸ“Š Internal Access Analyzer (Manual Setup)                              â”‚   â”‚  â”‚
â”‚  â”‚     â†’ Monitors internal access patterns                                  â”‚   â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚  â”‚
â”‚                                                                                   â”‚  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚  â”‚
â”‚  â”‚ ACT III: Custom Policy Checks (CI/CD Integration)                        â”‚   â”‚  â”‚
â”‚  â”‚                                                                           â”‚   â”‚  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                â”‚   â”‚  â”‚
â”‚  â”‚  â”‚  S3: PolicyDocumentsBucket           â”‚                                â”‚   â”‚  â”‚
â”‚  â”‚  â”‚  picklescorp-policies-{account}      â”‚                                â”‚   â”‚  â”‚
â”‚  â”‚  â”‚                                       â”‚                                â”‚   â”‚  â”‚
â”‚  â”‚  â”‚  â€¢ Versioning: Enabled               â”‚                                â”‚   â”‚  â”‚
â”‚  â”‚  â”‚  â€¢ Stores policy documents           â”‚                                â”‚   â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                â”‚   â”‚  â”‚
â”‚  â”‚                                                                           â”‚   â”‚  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                â”‚   â”‚  â”‚
â”‚  â”‚  â”‚  IAM: PolicyCheckRole                â”‚                                â”‚   â”‚  â”‚
â”‚  â”‚  â”‚  picklescorp-policy-check-role       â”‚                                â”‚   â”‚  â”‚
â”‚  â”‚  â”‚                                       â”‚                                â”‚   â”‚  â”‚
â”‚  â”‚  â”‚  Permissions:                         â”‚                                â”‚   â”‚  â”‚
â”‚  â”‚  â”‚  â€¢ CheckNoNewAccess                  â”‚                                â”‚   â”‚  â”‚
â”‚  â”‚  â”‚  â€¢ CheckAccessNotGranted             â”‚                                â”‚   â”‚  â”‚
â”‚  â”‚  â”‚  â€¢ CheckNoPublicAccess               â”‚                                â”‚   â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                â”‚   â”‚  â”‚
â”‚  â”‚                                                                           â”‚   â”‚  â”‚
â”‚  â”‚  ğŸ”„ Used by CI/CD Pipeline for policy validation                         â”‚   â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚  â”‚
â”‚                                                                                   â”‚  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
                                                                                        â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  External AWS Account: 762337013574                                               â”‚ â”‚
â”‚                                                                                     â”‚ â”‚
â”‚  ğŸ”‘ Has access to AliceExternalBucket                                             â”‚â—„â”˜
â”‚     (GetObject, ListBucket permissions)                                            â”‚
â”‚                                                                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜


## Architecture Summary

### Resources Created:

**Scenario 1 - External Access Detection:**
- 1x S3 Bucket (with cross-account access to account 762337013574)

**Scenario 2 - Unused Access Detection:**
- 1x Lambda Function (Python 3.12)
- 1x IAM Role (with 3 overly-permissive managed policies)

**Scenario 3 - Internal Access Monitoring:**
- 1x DynamoDB Table (customer data)
- 1x S3 Bucket (critical data with account-wide access)
- 1x IAM Role (dev role with table access)

**Act III - CI/CD Policy Validation:**
- 1x S3 Bucket (versioned, for policy documents)
- 1x IAM Role (for running Access Analyzer policy checks)

### Key Security Patterns Demonstrated:

1. **Cross-Account Access** - External bucket shared with another AWS account
2. **Over-Permissioned Roles** - Lambda with full access to S3, DynamoDB, and SQS (only needs S3 read)
3. **Broad Internal Access** - Critical resources accessible account-wide
4. **Policy Validation** - CI/CD integration for automated security checks

### Access Analyzers (Created Manually):
- External Access Analyzer â†’ Detects resources shared outside zone of trust
- Unused Access Analyzer â†’ Identifies unused IAM permissions
- Internal Access Analyzer â†’ Monitors access patterns within zone of trust
```
